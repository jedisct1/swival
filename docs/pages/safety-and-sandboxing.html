<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Safety & Sandboxing — Swival</title>
    <meta name="description" content="Safety & Sandboxing — Swival documentation">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Safety & Sandboxing — Swival">
    <meta property="og:description" content="Safety & Sandboxing — Swival documentation">
    <meta property="og:image" content="https://swival.dev/img/logo.png">
    <meta property="og:url" content="https://swival.dev/pages/safety-and-sandboxing.html">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Safety & Sandboxing — Swival">
    <meta name="twitter:description" content="Safety & Sandboxing — Swival documentation">
    <meta name="twitter:image" content="https://swival.dev/img/logo.png">
    <link rel="icon" href="../favicon.ico">
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="site-header">
        <div class="header-inner">
            <a href="../" class="header-logo">
                <img src="../img/logo.png" alt="Swival">
            </a>
            <nav class="header-nav">
                <a href="./">Docs</a>
                <a href="https://github.com/swival/swival">GitHub</a>
            </nav>
        </div>
    </header>
    <div class="docs-layout">
        <aside class="sidebar">
            <div class="sidebar-section">
<h4>Basics</h4>
<ul>
<li><a href="getting-started.html">Getting Started</a></li>
<li><a href="usage.html">Usage</a></li>
<li><a href="tools.html">Tools</a></li>
</ul>
</div>
<div class="sidebar-section">
<h4>Configuration & Deployment</h4>
<ul>
<li><a href="safety-and-sandboxing.html" class="active">Safety & Sandboxing</a></li>
<li><a href="skills.html">Skills</a></li>
<li><a href="mcp.html">MCP</a></li>
<li><a href="customization.html">Customization</a></li>
<li><a href="providers.html">Providers</a></li>
<li><a href="reports.html">Reports</a></li>
<li><a href="reviews.html">Reviews</a></li>
<li><a href="agentfs.html">AgentFS</a></li>
</ul>
</div>
        </aside>
        <article class="docs-content">
            <h1 id="safety-and-sandboxing">Safety and Sandboxing</h1>
<p>Swival's built-in sandbox is implemented at the application layer. It validates paths and enforces command policy in Python, but it is not an operating-system isolation boundary. You should treat it as a strong guardrail for normal use, not as a hard security perimeter against untrusted or adversarial models.</p>
<p>If you need stronger isolation, wrap Swival with an OS-level sandbox. <a href="agentfs.html">AgentFS</a> gives you copy-on-write filesystem isolation so agent edits do not touch your real tree until you copy files back. On macOS, <code>sandbox-exec</code> can additionally limit network, process, and filesystem capabilities at the kernel policy level.</p>
<pre><code class="language-sh">sandbox-exec -p '(version 1)(allow default)(deny network*)' \
    swival &quot;task&quot; --yolo
</code></pre>
<p>AgentFS and <code>sandbox-exec</code> can be combined when you want both writable sandboxed development flow and stricter system-level controls.</p>
<h2 id="base-directory-enforcement">Base Directory Enforcement</h2>
<p>All filesystem operations are anchored to <code>--base-dir</code>, which defaults to the current directory. Path checks resolve both the base directory and target path through symlinks, then verify that the resolved target remains inside an allowed root. If a path escapes through traversal or symlink indirection, the operation fails.</p>
<p>Even in YOLO mode, Swival blocks the filesystem root itself. You cannot grant the agent unrestricted access to <code>/</code> by accident.</p>
<h2 id="additional-allowed-directories">Additional Allowed Directories</h2>
<p>When the agent needs full access outside <code>--base-dir</code>, pass one or more <code>--add-dir</code> flags.</p>
<pre><code class="language-sh">swival --add-dir ~/shared-data --add-dir /opt/configs &quot;Update the config&quot;
</code></pre>
<p>When the agent only needs to read files without modifying them, use <code>--add-dir-ro</code> instead.</p>
<pre><code class="language-sh">swival --add-dir-ro ~/reference-docs --add-dir-ro /opt/datasets &quot;Analyze the data&quot;
</code></pre>
<p>Both flags can be combined. The agent gets read-write access to <code>--add-dir</code> paths and read-only access to <code>--add-dir-ro</code> paths.</p>
<pre><code class="language-sh">swival --add-dir ./output --add-dir-ro ~/corpus &quot;Summarize the corpus into output/&quot;
</code></pre>
<p>Each allowed directory must already exist, must be a directory, and cannot be the filesystem root. In REPL mode, you can grant the same access dynamically with <code>/add-dir &lt;path&gt;</code> or <code>/add-dir-ro &lt;path&gt;</code>.</p>
<h2 id="command-execution-policy">Command Execution Policy</h2>
<p>Command execution is off by default. The agent only receives <code>run_command</code> when you explicitly enable it.</p>
<p>In whitelist mode, you pass a comma-separated set of command basenames.</p>
<pre><code class="language-sh">swival --allowed-commands ls,git,python3 &quot;task&quot;
</code></pre>
<p>At startup, each basename is resolved to an absolute path using <code>which</code>. If a command cannot be found, Swival exits with an error. If a command resolves inside your base directory, Swival rejects it so the agent cannot modify and execute workspace binaries in one session.</p>
<p>At runtime in whitelist mode, commands must be passed as argument arrays, not shell strings. This removes shell interpolation and injection risk from ordinary command calls.</p>
<p>In YOLO mode, both the filesystem sandbox and the command whitelist are disabled. The agent can read or write any non-root path and run arbitrary commands.</p>
<pre><code class="language-sh">swival --yolo &quot;do whatever you want&quot;
</code></pre>
<h2 id="read-before-write-guard">Read-Before-Write Guard</h2>
<p>By default, Swival blocks writes to existing files unless that file has already been read or previously written during the current session. This reduces accidental overwrites when the model has not inspected current file contents.</p>
<p>This guard also applies when <code>write_file</code> uses <code>move_from</code> and the destination already exists. The source path is exempt from the read requirement because renaming does not modify source content.</p>
<p>If you intentionally want direct write access without prior reads, disable the guard with <code>--no-read-guard</code>.</p>
<pre><code class="language-sh">swival --no-read-guard &quot;task&quot;
</code></pre>
<h2 id="url-fetching-and-ssrf-protections">URL Fetching And SSRF Protections</h2>
<p>The <code>fetch_url</code> tool only allows <code>http</code> and <code>https</code>. It resolves each hostname with <code>socket.getaddrinfo</code>, blocks private and internal address classes through <code>ipaddress</code>, and re-runs those checks on every redirect hop. Redirect chains are handled manually and capped at ten hops, which prevents public-to-private redirect abuse patterns.</p>
<p>Binary MIME types are rejected. Response bodies are capped at 5 MB before conversion, and converted inline output is capped at 50 KB.</p>
<h2 id="output-caps">Output Caps</h2>
<p>Several hard caps keep the conversation bounded. File reads are limited to 50 KB per call and lines are truncated at 2,000 characters. Directory and grep-style listings are capped at 100 results.</p>
<p>Command output is capped at 10 KB inline, with larger output written to <code>.swival/</code> for paginated reads and auto-cleaned after roughly ten minutes. MCP tool output uses higher thresholds: 20 KB inline, with larger output written to <code>.swival/</code> and hard-capped at 10 MB before writing. MCP error output is inline-capped at 20 KB without file save.</p>
<p>URL fetch output is capped at 50 KB inline, with larger output saved to files. Response history is written to <code>.swival/HISTORY.md</code> until that file reaches 500 KB, after which new entries are skipped.</p>
        </article>
    </div>
    <footer class="site-footer">
        MIT License &middot;
        <a href="https://github.com/swival/swival">GitHub</a>
    </footer>
</body>
</html>